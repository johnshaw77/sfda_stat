# T-Test 統計分析系統 TODO 清單

## 📋 系統架構概覽

```
AI 主系統 → 上傳 CSV → AI 分析判斷 → 呼叫 MCP 工具 → SFDA Stat API → 統計計算 → 結果回傳
```

## 🎯 當前專注：T-Test 功能

### Phase 1: 測試和驗證當前 T-Test 實作 ✅
- [x] 確認 FastAPI 伺服器正常運行 (http://localhost:8001)
- [x] 確認 T-Test API 端點存在 (`/inferential/ttest`)
- [ ] 建立測試樣本數據
- [ ] 測試各種 T-Test 場景
- [ ] 驗證結果正確性

### Phase 2: 建立測試數據集 📊
- [ ] 建立單樣本 t 檢定測試數據
  - [ ] 正常分布數據（應該不拒絕 H0）
  - [ ] 偏移分布數據（應該拒絕 H0）
- [ ] 建立雙樣本獨立 t 檢定測試數據
  - [ ] 相同分布的兩組數據
  - [ ] 不同分布的兩組數據
- [ ] 建立配對 t 檢定測試數據
  - [ ] 前後測數據
  - [ ] 治療效果數據

### Phase 3: API 測試腳本開發 🧪
- [ ] 建立 Python 測試腳本
- [ ] 建立 curl 測試命令
- [ ] 建立 Postman 集合
- [ ] 驗證所有 t-test 場景

### Phase 4: CSV 數據處理功能 📁
- [ ] 建立 CSV 上傳端點
- [ ] CSV 數據驗證和清理
- [ ] 自動偵測數據類型和結構
- [ ] 建立數據預處理管道

### Phase 5: AI 智能分析判斷 🤖
- [ ] 設計 AI 提示模板
  - [ ] 數據結構分析提示
  - [ ] 統計檢定選擇提示
  - [ ] 參數建議提示
- [ ] 建立決策邏輯
  - [ ] 單樣本 vs 雙樣本判斷
  - [ ] 配對 vs 獨立樣本判斷
  - [ ] 顯著水準建議

### Phase 6: MCP 工具集成 🔧
- [ ] 設計 MCP 工具接口
- [ ] 建立統計分析 MCP 工具
- [ ] 測試 MCP 工具調用
- [ ] 優化錯誤處理

## 🧪 測試樣本數據規劃

### 1. 單樣本 t 檢定數據
```csv
# dataset1_normal.csv - 測試 H0: μ = 0 (不應拒絕)
values
-0.2
0.1
-0.5
0.3
0.2
...

# dataset2_shifted.csv - 測試 H0: μ = 0 (應該拒絕)
values
2.1
2.3
1.8
2.5
2.0
...
```

### 2. 雙樣本獨立 t 檢定數據
```csv
# dataset3_two_groups.csv
group,value
A,10.2
A,11.1
A,9.8
B,12.1
B,13.2
B,11.9
...
```

### 3. 配對 t 檢定數據
```csv
# dataset4_paired.csv
subject,before,after
1,85,88
2,92,95
3,78,82
...
```

## 🔍 測試案例設計

### 案例 1: 藥物效果測試（配對 t 檢定）
- **場景**: 測試新藥物對血壓的影響
- **數據**: 20 位患者的用藥前後血壓
- **預期**: AI 應該識別為配對 t 檢定
- **H0**: 用藥前後血壓無差異

### 案例 2: 兩組學生成績比較（獨立 t 檢定）
- **場景**: 比較兩種教學方法的效果
- **數據**: A 組和 B 組學生的考試成績
- **預期**: AI 應該識別為獨立雙樣本 t 檢定
- **H0**: 兩組成績無差異

### 案例 3: 產品品質檢測（單樣本 t 檢定）
- **場景**: 檢測產品重量是否符合標準
- **數據**: 100 個產品的重量測量值
- **預期**: AI 應該識別為單樣本 t 檢定
- **H0**: 平均重量 = 標準重量

## 📝 當前問題和注意事項

### 發現的問題
1. **API 調用不一致**: 
   - `inferential.py` 中調用 `stats_service.perform_ttest()`
   - 但 `inferential_stats.py` 中方法名為 `ttest()`
   
2. **需要驗證的功能**:
   - [ ] 單樣本 t 檢定是否正確實作
   - [ ] 配對檢定邏輯
   - [ ] p 值調整邏輯
   - [ ] 臨界值計算

### 技術債務
- [ ] 統一方法命名規範
- [ ] 增加更詳細的錯誤處理
- [ ] 加入數據驗證（常態性檢定等）
- [ ] 增加統計功效計算

## 🚀 下一步行動計劃

### 立即行動 (今天)
1. **修正 API 調用問題**
2. **建立基本測試數據**
3. **測試當前 t-test 功能**

### 短期目標 (本週)
1. **完成所有 t-test 場景測試**
2. **建立完整的測試數據集**
3. **驗證統計計算正確性**

### 中期目標 (下週)
1. **設計 AI 分析邏輯**
2. **建立 CSV 處理功能**
3. **開始 MCP 工具設計**

## 💡 建議的開發順序

1. **先修正當前代碼問題** → 確保基礎功能正常
2. **建立測試框架** → 確保質量
3. **逐步增加智能功能** → AI 分析、自動判斷
4. **最後集成 MCP** → 完整的工作流程

---

## ⚠️ 決策點

**問題**: 是否要繼續按照這個計劃進行？

**考慮因素**:
- 當前基礎功能是否穩定
- 測試數據是否足夠
- AI 集成的複雜度
- MCP 工具的開發時間

**建議**: 先專注 Phase 1-3，確保 t-test 功能完全正確，再考慮後續的 AI 和 MCP 集成。
